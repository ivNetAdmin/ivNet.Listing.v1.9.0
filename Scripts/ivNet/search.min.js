var Search = angular.module('ivNet.Search', ['ngResource', 'trNgGrid', 'ngSanitize']);

Search.factory('searchListings', function ($resource) {
    return $resource('/api/listing/search/:id', null,
    {
        'query': { method: 'GET', isArray: true }
    });
});

Search.controller('SearchController', function ($scope, $attrs, searchListings) {

    $scope.showListing = function(item) {
        window.location.replace("/listing?id=" + item.ListingId + '-' + $attrs.search);
    };

    init();

    function init() {

        $('table.table').hide();
        $('span.search-message').show();
        $('div#throbber').addClass('throbber-loader');
        $scope.search_fields = ['ImageUrl', 'Description', 'StrapLine', 'Address','Owner', 'Price', 'Featured'];
        searchListings.query({ id: $attrs.search },
            function (data) {
                $scope.listings = data;
                $('table.table').show();
                $('span.search-message').hide();
                $('div#throbber').removeClass('throbber-loader');
            },
            function(error) {
                alert(error.data.Message + ' [' + error.data.MessageDetail + ']');
                $('div#throbber').removeClass('throbber-loader');
            });
    };
});